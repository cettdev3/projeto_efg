{% extends "index.html" %} {% block content %} {% load static %}
<style>
  #myInput {
  background-repeat: no-repeat; /* Do not repeat the icon image */
  width: 100%; /* Full-width */
  font-size: 16px; /* Increase font-size */
  padding: 12px 20px 12px 40px; /* Add some padding */
  border: 1px solid #ddd; /* Add a grey border */
  margin-bottom: 12px; /* Add some space below the input */
}



#myTable {
  border-collapse: collapse; /* Collapse borders */
  width:100%; /* Full-width */
  border: 1px solid #ddd; /* Add a grey border */

}

#myTable th, #myTable td {
  text-align: center; /* Left-align text */
  padding: 10px; /* Add padding */
}

#myTable tr {
  /* Add a bottom border to all table rows */
  border-bottom: 1px solid #ddd;
}

#myTable tr.header, #myTable tr:hover {
  /* Add a grey background color to the table header and on hover */
  background-color: #00f36d6c;
}

@media screen and (max-width: 1280px) {
    .myTable {
        border: 0px;
    }
    .myTable caption {
        font-size: 22px;
    }
    .myTable thead {
        display: none;
    }
    .TamyTableble tr {
        margin-bottom: 8px;
        border-bottom: 4px solid #ddd;
        display: block;
        
    }
    .myTable th, .table td {
        font-size: 12px;
        
    }
    .myTable td {
        display: block;
        border-bottom: 1px solid #ddd;
        
        
    }
    .myTable  td:last-child {
        border-bottom: 0px;
    }
    .myTable td::before {
        content: attr(data-label);
        font-weight: bold;
        text-transform: uppercase;
        float: left;
    }
    .myTable button, btn_voltar{
      width: 100%;
      margin-bottom: 10px;
    }
}
    </style>
<div class="page-heading">
  <h3>Cadastrar Cursos por Escola - EFG</h3>
</div>
<div class="card">
  <div class="card-header">
    <h4 class="card-title">Inserir metas de ensino do convênio</h4>
  </div>

  <div class="card-body">
    <div class="column">
      <div>
        <form
          name="Form"
          id="Form"
          class="form-control"
          method="post"
          action="/cad-curso-escola"
        >
          {% csrf_token %} {% if messages %} {% for message in messages %}
          <div class="alert alert-dismissible alert-success" role="alert">
            <strong class="text-dark">{{message}}</strong>
          </div>
          {% endfor %} {% endif %}

          <div class="row">
           

            <div class="col-md-4 form-group">
              <label for="basicInput"><b>Escola:</b></label>
              <select class="form-control" id="escola" name="escola">
                {% for escola in escolas %}
                <option value="{{escola.id}}">{{escola.escola}}</option>
                {% endfor %}            
              </select>
            </div>

            <div class="col-md-6 form-group">
              <label for="basicInput"><b>Curso:</b></label>
              <select class="form-control" id="curso" name="curso">
                {% for curso in cursos %}
                <option value="{{curso.id}}">{{curso.curso}}</option>
                {% endfor %}
              </select>
            </div>

            <div class="col-md-2 form-group">
              <label for="basicInput"><b>Status:</b></label>
              <select class="form-control" id="status" name="status">
                <option value="ATIVO">ATIVO</option> 
                <option value="INATIVO">INATIVO</option>  
              </select>
            </div>

           
          </div>

          <div class="form-group" style="width: 100%; text-align: right">
            <a href="/" id="btn_voltar" class="btn btn-secondary">Voltar</a>
            <button type="submit" class="btn btn-success">Cadastrar Curso</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<section class="section">
  <div class="card">
    <div class="card-header">
      <h4 class="card-title">Cursos Adicionados por Escola</h4>
      <input
        type="text"
        id="myInput"
        onkeyup="myFunction()"
        placeholder="Procurar Escola..."
      />
    </div>

    <div class="card-body">
      <table id="myTable" class="myTable">
        <thead>
          <tr>
            <th>Escola</th>
            <th>Curso</th>
            <th>Status</th>
            <th>Ação</th>
          </tr>
        </thead>
        <tbody id="tabela_metas">
          {% for info in dados %}

                  <tr>
                    <td><span style="display: none;" id="escola{{info.id}}">{{info.id}}</span>{{info.escola}}</td>
                    <td><span style="display: none;" id="curso{{info.id_curso}}">{{info.id_curso}}</span>{{info.curso}}</td>
                    {% if info.status == "ATIVO" %}
                    <td ><a  style="width: 100%;" class="btn btn-success btn-icon-split">
                      <span class="icon text-white-50">
                          <i class="fas fa-check"></i>
                      </span>
                      <span id="status{{info.id}}" class="text">{{info.status}}</span>
                  </a></td>
                    {% else %}
                    <td><a   style="width: 100%;" class="btn btn-warning btn-icon-split text-dark">
                      <span class="icon text-white-50">
                          <i class="fas fa-check"></i>
                      </span>
                      <span  id="status{{info.id}}" class="text">{{info.status}}</span>
                  </a></td>
                    {% endif %}
                    <td>
                      <button type="button" onclick='atualiza("{{info.id}}","{{info.id_curso}}","{{info.id_registro}}")' class="btn icon btn-primary" data-bs-toggle="modal" data-bs-target="#xlarge">
                        <i class="bi bi-pencil"></i>
                      </button>
                      <button
                        type="button"
                        onclick='insereTexto("{{info.id_registro}}")'
                        class="btn icon btn-danger"
                        data-bs-toggle="modal"
                        data-bs-target="#warning"
                      >
                        <i class="bi bi-x"></i>
                      </button>
                      <!---<a  class="deleteFromMeta btn icon btn-danger" href="apagar-meta/{{meta.id}}"><i class="bi bi-x"></i></a></td>-->
                    </td>
                  </tr>
                        
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</section>

<div
  class="modal fade text-left"
  id="warning"
  tabindex="-1"
  role="dialog"
  aria-labelledby="myModalLabel140"
  aria-hidden="true"
>
  <div
    class="modal-dialog modal-dialog-centered modal-dialog-scrollable"
    role="document"
  >
    <div class="modal-content">
      <div class="modal-header bg-danger">
        <h5 class="modal-title white" id="myModalLabel140">
          Confirma a exclusão do curso nesta escola?
        </h5>
        <button
          type="button"
          class="close"
          data-bs-dismiss="modal"
          aria-label="Close"
        >
          <i data-feather="x"></i>
        </button>
      </div>

      <div class="modal-body">Ao confirmar, o curso será retirado desta unidade.</div>
      <div class="modal-footer">
        <form
          name="Form"
          id="Form"
          method="POST"
          action="/apagar-curso-escola"
        >
          {% csrf_token %}
          <div style="display: none">
            <input type="text" id="id_deleta" name="id_deleta" />
          </div>
          <button
            type="button"
            class="btn btn-light-secondary"
            data-bs-dismiss="modal"
          >
            <i class="bx bx-x d-block d-sm-none"></i>
            <span class="d-none d-sm-block">Fechar</span>
          </button>
          <button class="btn btn-danger ml-1" type="submit">
            Confirmar Exclusão
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<div
  class="modal fade text-left w-100"
  id="xlarge"
  tabindex="-1"
  role="dialog"
  aria-labelledby="myModalLabel16"
  aria-hidden="true"
>
  <div
    class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl"
    role="document"
  >
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="myModalLabel16">Editar Dados</h4>
        <button
          type="button"
          class="close"
          data-bs-dismiss="modal"
          aria-label="Close"
        >
          <i data-feather="x"></i>
        </button>
      </div>
      <div class="modal-body">
        <form
          name="Form"
          id="form_update"
          class="form-control"
          method="post"
          action="/editar-curso-escola"
        >
          {% csrf_token %}

          <input
            type="Text"
            class="form-control"
            id="id_edit"
            name="id_edit"
            placeholder="Informe a escola:"
            style="display: none;"
          />

          <div class="row">
           

            <div class="col-md-4 form-group">
              <label for="basicInput"><b>Escola:</b></label>
              <select class="form-control" id="escola_modal" name="escola_modal">
                {% for escola in escolas %}
                <option value="{{escola.id}}">{{escola.nome}}</option>
                {% endfor %}            
              </select>
            </div>

            <div class="col-md-6 form-group">
              <label for="basicInput"><b>Curso:</b></label>
              <select class="form-control" id="curso_modal" name="curso_modal">
                {% for curso in cursos %}
                <option value="{{curso.id}}">{{curso.nome}}</option>
                {% endfor %}            
              </select>
            </div>

            <div class="col-md-2 form-group">
              <label for="basicInput"><b>Status:</b></label>
              <select class="form-control" id="status_modal" name="status_modal">
                <option value="ATIVO">ATIVO</option> 
                <option value="INATIVO">INATIVO</option>  
              </select>
            </div>

           
          </div>

          <div class="form-group" style="width: 100%; text-align: right">
          <button data-bs-dismiss="modal" type="submit" class="btn btn-light-secondary">Fechar</button> <button type="submit" class="btn btn-success">Editar Alocação de Curso</button>
          </div>
        </form>
      </div>
    
    </div>
  </div>
</div>
{% block javascript %}
<script>
  function insereTexto(id) {
    document.getElementById("id_deleta").value = id;
  }

  function atualiza(id,id_curso,id_registro) {
    document.getElementById("id_edit").value = id_registro;
    let escola = document.getElementById("escola"+id).innerHTML
    let curso = document.getElementById("curso"+id_curso).innerHTML
    let status = document.getElementById("status"+id).innerHTML

    $('#escola_modal').val(escola.trim()).change();
    $('#curso_modal').val(curso.trim()).change();
    $('#status_modal').val(status.trim()).change();



    
  }
</script>

<script>

  function myFunction() {
    var input, filter, table, tr, td, i, txtValue;
    input = document.getElementById("myInput");
    filter = input.value.toUpperCase();
    table = document.getElementById("myTable");
    tr = table.getElementsByTagName("tr");
  
    // Loop through all table rows, and hide those who don't match the search query
    for (i = 0; i < tr.length; i++) {
      td = tr[i].getElementsByTagName("td")[0];
      if (td) {
        txtValue = td.textContent || td.innerText;
        if (txtValue.toUpperCase().indexOf(filter) > -1) {
          tr[i].style.display = "";
        } else {
          tr[i].style.display = "none";
        }
      }
    }
  }
  
  </script>

<script>
 
  function calcular() {
    var n1 = parseInt(document.getElementById("repasse").value, 10);
    var n2 = parseInt(document.getElementById("ch_ofertada").value, 10);
    var resultado = n1 / n2;
    document.getElementById("valor_unitario").value = resultado.toFixed(2);
  }
</script>

<script>
  function calcular2() {
    var n1 = parseInt(document.getElementById("repasse2").value,10);
    var n2 = parseInt(document.getElementById("ch_ofertada2").value,10);
    var resultado = n1 / n2;
    document.getElementById("valor_unitario2").value = resultado.toFixed(2);
  }
</script>

<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
 <script src="https://cdn.datatables.net/1.12.1/js/dataTables.bootstrap4.min.js"></script>
{% endblock %}

{% endblock content %}
