{% extends "index.html" %} 
{% load static %}
{% block content %} 
<style>
  body {
            overflow-x: hidden; /* Desativa o scroll horizontal */
        }
.spinner {
  animation: spin 1s linear infinite;
}

#spinner-background {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5); /* cor de fundo escuro */
  z-index: 9999;
}

#spinner-container {
  
  position: fixed;
  top: 50%;
  left: 50%;
  width: 100%;
  height: 100%;
  
  z-index: 9999;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
/* FIM DO SPINER ACIMA*/
.modal-extra-wide .modal-dialog {
            max-width: 90%;
        }
  /* The container <div> - needed to position the dropdown content */
.dropdown {
    position: relative;
    display: block;
    float: right;
}

.dropdown-content {
    display: none;
    position: absolute;
    right: 0;
    background-color: #f9f9f9;
    min-width: 160px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1;

}

.dropdown-content a {
    color: black;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
}

.dropdown-content a:hover {
    background-color: #000000;
    color: #fff;
}
  #myInput {
  background-repeat: no-repeat; /* Do not repeat the icon image */
  width: 100%; /* Full-width */
  font-size: 16px; /* Increase font-size */
  padding: 12px 20px 12px 40px; /* Add some padding */
  border: 1px solid #ddd; /* Add a grey border */
  margin-bottom: 12px; /* Add some space below the input */
}

table {
  
text-align: left;
width: 100%;
align-items: center;
font-family: 'Open Sans', sans-serif;
border-collapse: collapse; /* Collapse borders */
  width:100%; /* Full-width */
  border: 1px solid #ddd; /* Add a grey border */
}

table thead th {

padding: 10px;
font-size: 12px;
color: #000;
font-weight: 600;
}

table tbody tr td {

display: table-cell;
font-weight: 400;
padding: 12px;
color: #363636;
text-align: left;
position: relative;
}

table tbody tr {

border: 1px solid #cacaca;
display: table-row;
}

table tbody tr:nth-child(odd) {

background: #dddddd4a;
}

table tbody tr td button {

display: inline-block;
padding: 10px 15px;
position: initial;
transform: translate(0);
width: auto;
}

table tbody tr td button {

background: #4CAF50;
border: none;
border-radius: 20px;
box-shadow: 0 4px 8px rgba(34, 34, 34, 0.2);
color: #fff;
font-weight: 700;;
padding: 10px 0;
width: 100%;
}

table thead {

display: table-header-group;
font-weight: 500;
}


table tbody tr td:before {

display: none;
}

table tbody tr td button:hover, table tbody tr td button:focus {

background: #0C504B;
color: #ffffff;
cursor: pointer;
}

@media all and (max-width: 800px) {

table tbody tr td {

    display: block;
    text-align: center;
}

table tbody tr td:before {

    content: attr(data-title);
    position: absolute;
    left: 15px;
    display: block;
    font-weight: 600;
    font-size: 1em;
}

table {

    border: none;
}

table thead {

    display: none;
}

table tbody tr {

    margin-bottom: 10px;
    display: block;
    border: 1px solid #dad6eb;
}

table button, btn_voltar{
      width: 100%;
      margin-bottom: 10px;
    }
};


#myTable2 {
  border-collapse: collapse; /* Collapse borders */
  width:100%; /* Full-width */
  border: 1px solid #ddd; /* Add a grey border */

}

#myTable2 th, #myTable2 td {
  text-align: center; /* Left-align text */
  padding: 10px; /* Add padding */
  overflow-wrap: break-word;
}

#myTable2 tr {
  /* Add a bottom border to all table rows */
  border-bottom: 1px solid #ddd;
}

#myTable2 tr.header, #myTable2 tr:hover {
  /* Add a grey background color to the table header and on hover */
  background-color: #00f36d6c;
}

@media screen and (max-width: 1280px) {
    .myTable2 {
        border: 0px;
    }
    .myTable2 caption {
        font-size: 22px;
    }
    .myTable2 thead {
        display: none;
    }
    .TamyTable2ble tr {
        margin-bottom: 8px;
        border-bottom: 4px solid #ddd;
        display: block;
        
    }
    .myTable2 th, .table td {
        font-size: 12px;
        
    }
    .myTable2 td {
        display: block;
        border-bottom: 1px solid #ddd;
        
        
    }
    .myTable2  td:last-child {
        border-bottom: 0px;
    }
    .myTable2 td::before {
        content: attr(data-label);
        font-weight: bold;
        text-transform: uppercase;
        float: left;
    }
    .myTable2 button, btn_voltar{
      width: 100%;
      margin-bottom: 10px;
    }
}

/*ESTILIZAÇÃO DOS CARDS*/
.cardBacklog {
  /* Add shadows to create the "card" effect */
  box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
  transition: 0.3s;
 
}

/* On mouse-over, add a deeper shadow */
.cardcardBacklog:hover {
  box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);
}

/* Add some padding inside the card container */
.containerBacklog {
  padding-top: 10px;
  margin: 0;
  text-align: center;
  background-color: #002EE3;
  color:#fff;

}

.containerBacklog h4{
  color: #fff;
}
    </style>
{% if 'ae' in permissoes.permission %}
<div class="page-heading">
  <h3>Retificar Edital</h3>
</div>
<div class="card">
  <div class="card-header">
    <h4 class="card-title">Retificação de Edital</h4>
  </div>

  <div class="card-body">
    <div class="column">
      <div>
        <form
          name="Form"
          id="Form"
          class="form-control"
          method="post"
          action="/aprova-edital"
          
        >
          {% csrf_token %}
         

          <div class="row">
            <div class="col-md-12 form-group">
              <label for="basicInput"><b>EDITAL</b>:</label>
              <select class="form-control" id="edital" name="edital">
                <option value="">------</option>
                
                {% for meta in editais %}

                <option value="{{meta.num_edital_id}}">{{meta.num_edital}} | {{meta.escola.escola}} | {{meta.tipo}} | {{meta.modalidade}} | {{meta.ano}}</option>
                <span id="idEdital">{{meta.num_edital_id}}</span>
                {% endfor %}
              </select>
            </div>
            </div>

            <div class="row" id="painel_edital">
              <div class="col-md-4 form-group">
                <label for="basicInput"><b>N° EDITAL:</b></label>
                <input readonly type="text" class="form-control" id="n_edital" name="n_edital">
              </div>
  
              <div class="col-md-6 form-group">
                <label for="basicInput"><b>ESCOLA:</b></label>
                <input  type="text" class="form-control" id="escola" name="escola">
              </div>
  
              <div class="col-md-2 form-group">
                <label for="basicInput"><b>ANO:</b></label>
                <input  type="number" class="form-control" id="ano" name="ano">
              </div>
  
              <div class="col-md-6 form-group">
                <label for="basicInput"><b>DATA INICIAL DO EDITAL:</b></label>
                <input
                  type="date"
                  class="form-control"
                  id="data_ini_edit"
                  name="data_ini_edit"
                  required
  
                >
              </div>
  
              <div class="col-md-6 form-group">
                <label for="basicInput"><b>DATA FINAL DO EDITAL:</b></label>
                <input
                  type="date"
                  class="form-control"
                  id="data_fim_edit"
                  name="data_fim_edit"
                  required
  
                >
              </div>
  
              <div class="col-md-6 form-group">
                <label for="basicInput"><b>DATA INICIAL DE INSCRIÇÃO:</b></label>
                <input
                  type="date"
                  class="form-control"
                  id="data_ini_insc"
                  name="data_ini_insc"
                  required
  
                >
              </div>
  
              <div class="col-md-6 form-group">
                <label for="basicInput"><b>DATA FINAL DE INSCRIÇÃO:</b></label>
                <input
                  type="date"
                  class="form-control"
                  id="data_fim_insc"
                  name="data_fim_insc"
                  required
  
                >
              </div>
            </div>
          </div>

        <br>

        </form>
      </div>
    </div>
</div>

<div class="card">
  <div class="card-header">
    <h4 class="card-title">Turmas Relacionadas ao Edital 
      <span style="float: right;" >Saldo de Retificação: <span id="soma-cargas">0</span></span>
</h4>
    
  </div>

  <div class="card-body">
    <div class="row">
      <div class="cold-md-12" style="text-align: right;">
    
       </div>

       <div class="cold-md-12">
        <table id="myTable" class="myTable">
          <thead>
            <tr>
              <th scope="col">Escola</th>
              <th scope="col">Tipo</th>
              <th scope="col">Curso</th>
              <th scope="col">Turno</th>
              <th scope="col">Modalidade</th>
              <th scope="col">Vagas Totais</th>
              <th scope="col">Início/Fim</th>
              <th scope="col">Carga Horária</th>
              <th scope="col">Município</th>
              <th scope="col">Status</th>
              <th scope="col">Retificação</th>
          </tr>
       
          </thead>
          <tbody id="tbl_metas_editais">
            
          </tbody>
        </table>
        <button  onclick="showModal()" style="margin-top: 10px; float: right;" type="button" class="btn btn-secondary">Adicionar Turmas</button>
   
      </div>
       
       
      </div>
      
    </div>
</div>
<div class="modal fade" id="ExemploModalCentralizado" tabindex="-1" role="dialog" aria-labelledby="TituloModalCentralizado" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog modal-xl" role="document">
    <div class="modal-content" >
      <div class="modal-header" >
        <h5 class="modal-title" id="TituloModalCentralizado" style="color: #000;">Adicionar Turmas</h5>
        <button type="button" class="close" onclick="hideModal()" aria-label="Fechar">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        ...
      </div>
      <div class="modal-footer">
        <button type="button"  onclick="hideModal()" class="btn btn-secondary">Fechar</button>
        <button type="button" class="btn btn-primary">Salvar mudanças</button>
      </div>
    </div>
  </div>
</div>
  {% else %}
<div class="alert alert-danger" role="alert">
  :'( Desculpe, mas você não tem permissões para acessar esta funcionalidade do sistema!
</div>
{% endif %}
</div>





{% block javascript %}



<script>
function showModal(){
  $("#ExemploModalCentralizado").modal('show')
}

function hideModal(){
  $("#ExemploModalCentralizado").modal('hide')
}

function exportData(){
    /* Get the HTML data using Element by Id */
    var table = document.getElementById("tabela_metas");
 
    /* Declaring array variable */
    var rows =[];
    header = ['N° Edital,Escola,Tipo,Ano,Data Inicial do Edital,Data Final do Edital,Data Inicial da Inscrição,Data Final da Inscrição,Status']
    rows.push(header)
    //iterate through rows of table
    for(var i=0,row; row = table.rows[i];i++){
        //rows would be accessed using the "row" variable assigned in the for loop
        //Get each cell value/column from the row
        column1 = row.cells[0].innerText;
        column2 = row.cells[1].innerText;
        column3 = row.cells[2].innerText;
        column4 = row.cells[3].innerText;
        column5 = row.cells[4].innerText;
        column6 = row.cells[5].innerText;
        column7 = row.cells[6].innerText;
        column8 = row.cells[7].innerText;
        column9 = row.cells[8].innerText;
       
  
        
 
    /* add a new records in the array */
        rows.push(
            [
                column1,
                column2,
                column3,
                column4,
                column5,
                column6,
                column7,
                column8,
                column9

            ]
        );
 
        }
        csvContent = "data:text/csv;charset=utf-8,";
         /* add the column delimiter as comma(,) and each row splitted by new line character (\n) */
        rows.forEach(function(rowArray){
            row = rowArray.join(",");
            csvContent += row + "\r\n";
        });
 
        /* create a hidden <a> DOM node and set its download attribute */
        var encodedUri = encodeURI(csvContent);
        var link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "Editais.csv");
        document.body.appendChild(link);
         /* download the data file named "Stock_Price_Report.csv" */
        link.click();
  }


  $("#edital").change(function(){
    const url = "/ajax/ajax-load-turmas-v2";
    // const url_table = "/ajax/ajax_load_turmas_edital_filtro";
    var url_turmas = "/ajax/ajax-load-turmas-edital";
    edital_id = document.getElementById('edital').value

    $.ajax({
          url : url,
          data: {'id': edital_id,},
          success: function(data){
              $("#painel_edital").html(data);
              $("#aprovar").show();
              $("#reprovar").show();
          }
      });

      $.ajax({
          url : url_turmas,
          data: {'editalId': edital_id,},
          success: function(data){
              $("#tbl_metas_editais").html(data);

          }
      });

 
  })

  function cancela_edital()
    {
      var edital_value = $( "#edital option:selected" ).text();
      var edital_id = document.getElementById('edital').value

      document.getElementById('id_edital_modal').value = edital_id
      document.getElementById('dados_edital').innerHTML = edital_value

      }

</script>




<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
 <script src="https://cdn.datatables.net/1.12.1/js/dataTables.bootstrap4.min.js"></script>
{% endblock %}

{% endblock content %}